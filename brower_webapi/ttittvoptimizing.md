# SSR에서 생기는 TTI - TTV 간극 줄이는 방법

(feat. mellona 님)

(+ Reflow, Repainting)



###### Update History

21.02.19 - 최초 작성.



## TTI - TTV 간극 줄이는 방법

렌더링 시점과 상호작용 시점의 차이를 줄여야하는데 **최대한 렌더링을 빠르게** 할 수 있어야겠죠.

이거는,, 음 페인팅과 렌더링 최적화를 통해 스트립트 로드까지의 시간을 줄이는 수 밖에 없어용.

브라우저 동작원리 공부 해보면 좋을 거 같습니다.

리플로우와 리페인팅의 차이에 대해서도 좀 알아보시믄 좋을듯함니다.

브라우저는 html코드 파싱해서ㅜ렌더링하다가 스크립트 태그 만나면 렌더링 멈추고 그 스크립트부터 로드하거든요.

그래서 보통 스크립트를 바디태그 맨밑에 붙여요.

일단 렌더링이 너무 걸리면 접근성이 너무 떨어지니까.

근데 그 과정에서 렌더링 시간이 길어질수록 스크립트 로드까지 가는 시간도 길어지죠.

그래서 렌더트리를 구축하고 그것들을 그릴 때 최대한 빠르게 그릴 수 있도록 불필요한 스타일 줄이고,
소위말하는 **렌더링 최적화라는 작업이 필요**합니다

렌더링최적화는 이제 **스타일이나 html태그 구조의 개선**으로도 이룰 수 있고,
리액트를 쓴다면 뭐 usecallback 등으로도 가능합니다.

근데 말씀하시는건 데이터의 변화가 아닌 최초 렌더링 상황을 가정하는 거 같아서,
아무래도 빠르게 그리고 스크립트 로드로 넘어가는 게 젤 좋죠.



## Reflow와 Repaint와 최적화

Reflow는 엘리먼트의 위치나 길이 등을 다시 계산하는 것으로 문서의 일부 혹은 전체를 렌더링한다.
단일 엘리먼트 하나를 변경해도 하위나 상위 엘리먼트에 영향을 줄 수 있다.
Repaint는 Reflow 과정이 끝난 후 생성된 렌더 트리를 다시 그리게 되는데 이 과정을 말한다.
그리고 레이아웃에는 영향을 주지 않지만 가시성에는 영향을 주는 엘리먼트가 변경되면 발생하는 것도 Repaint라 한다.
오페라에 따르면 브라우저가 DOM 트리에 있는 다른 모든 노드의 가시성을 확인해야 하므로 비용이 많이 든다고 한다.
최적화 방법클래스 변경이 필요할 경우 말단 노드의 클래스를 변경한다.
최대한 말단 노드를 변경하여 리플로우 영향을 최소화한다.
인라인 스타일을 사용하지 않는다.
인라인 스타일은 HTML이 다운로드될 때 레이아웃에 영향을 미치면서 추가 리플로우를 발생시킨다.
애니메이션이 들어간 엘리먼트는 position을 fixed나 absolute로 지정한다.
absolute나 fixed는 다른 엘리먼트의 레이아웃에 영향을 미치지 않는다.
리플로우가 아니라 리페인트가 발생하는데 이는 훨씬 적은 비용이 든다.
부드러운 애니메이션은 성능을 저하시킨다.
부드러운 애니메이션은 성능이 떨어지는 디바이스에서 말썽을 부릴 수 있다.
엘리먼트를 한 프레임당 4px씩 이동하면 덜 부드러워 보이겠지만 리플로우 처리의 1/4만 필요하다.
레이아웃을 위한 table은 피한다.
테이블은 점진적으로 렌더링되지 않고 모두 불려지고 계산된 다음에서야 렌더링된다.
또한 작은 변경으로도 테이블의 다른 모든 노드에 대한 리플로우가 발생한다.
CSS에 Javascript 표현식은 사용하지 않는다.
IE와 FF는 CSS에 Javascript를 실행할 수 있다
문서가 리플로우 될 때마다 그 표현식이 다시 계산된다.
CSS 하위 셀렉터를 최소화한다.
사용하는 규칙이 적을수록 리플로우가 빠르다.
숨겨진 엘리먼트를 변경한다
display: none;으로 숨겨진 엘리먼트는 변경될 때는 리페인트나 리플로우가 발생하지 않는다.
브라우저 도구로 리페인트 이슈 분석하기.
모든 주류 브라우저는 리플로우가 성능에 미치는 영향을 보여주는 타임라인 기능을 제공한다.



이거 참고하시믄 얼추 도움이 되실 수도 있습니다